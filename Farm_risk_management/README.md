# Farm_risk_management

Вы работаете в IT-компании, которая выполняет на заказ проекты по машинному обучению. К вам обратился фермер, владелец молочного хозяйства «Вольный луг». Он хочет купить бурёнок, чтобы расширить поголовье стада коров. Для этого он заключил выгодный контракт с ассоциацией пастбищ «ЭкоФерма».  
Условия позволяют фермеру очень тщательно отобрать коров. Он определяет качество молока по строгой методике, и при этом ему нужно выполнять свой план развития молочного хозяйства. Фермер хочет, чтобы каждая бурёнка давала не менее 6000 килограммов молока в год, а её надой был вкусным — строго по его критериям, ничуть не хуже. А продавцы и технологи так и норовят приукрасить своих коровок!  
Поэтому он просит вас разработать модель машинного обучения, которая поможет ему управлять рисками и принимать объективное решение о покупке. «ЭкоФерма» готова предоставить подробные данные о своих коровах.   

**Задание №1:**
Вам нужно создать две прогнозные модели для отбора бурёнок в поголовье:  
- Первая будет прогнозировать возможный удой коровы (целевой признак Удой);  
- Вторая — рассчитывать вероятность получить вкусное молоко от коровы (целевой признак Вкус молока).  
**Задание №2:**
С помощью модели нужно отобрать коров по двум критериям:  
- средний удой за год — не менее 6000 килограммов;
- молоко должно быть вкусным.

## Описание данных
Файл `ferma_main.csv` содержит данные о стаде фермера на текущий момент:
- `id` — уникальный идентификатор коровы.
- `Удой`, кг — масса молока, которую корова даёт в год (в килограммах).
- `ЭКЕ` (Энергетическая кормовая единица) — показатель питательности корма коровы.
- `Сырой протеин`, г — содержание сырого протеина в корме (в граммах).
- `СПО` (Сахаро-протеиновое соотношение) — отношение сахара к протеину в корме коровы.
- `Порода` — порода коровы.
- `Тип пастбища` — ландшафт лугов, на которых паслась корова.
- `порода папы_быка` — порода папы коровы.
- `Жирность,%` — содержание жиров в молоке (в процентах).
- `Белок,%` — содержание белков в молоке (в процентах).
- `Вкус молока` — оценка вкуса по личным критериям фермера, бинарный признак (вкусно, не вкусно).
- `Возраст` — возраст коровы, бинарный признак (менее 2 лет, более 2 лет).

Файл `ferma_dad.csv` хранит имя папы каждой коровы в стаде фермера:
- `id` — уникальный идентификатор коровы.
- `Имя Папы` — имя папы коровы.

Файл `cow_buy.csv` содержит данные о коровах «ЭкоФермы», которых фермер хочет изучить перед покупкой:
- `Порода` — порода коровы.
- `Тип пастбища` — ландшафт лугов, на которых паслась корова.
- `порода папы_быка` — порода папы коровы.
- `Имя_папы` — имя папы коровы.
- `Текущая_жирность,%` — содержание жиров в молоке (в процентах).
- `Текущий_уровень_белок,%` — содержание белков в молоке (в процентах).
- `Возраст` — возраст коровы, бинарный признак (менее 2 лет, более 2 лет).

Conclusion (Вывод):
1. Был произведен предварительный анализ данных.
2. Была произведена предобработка данных:
    - Были приведены названия столбцов датафреймов к типу snake_case;
    - Обработаны и удалены явные дубликаты (в количестве 9 штук) и неявные дубликаты;
    - Были изменены типы данных для числовых данных в датафреймах.
3. Был выполнен исследовательский анализ данных:
    - Было удаленно анамальное значение в стобце `yield` датафрема df_main;
    - Были удалены выбросы в столбце `protein` датафрема df_main;
    - Параметр `spr` (Сахаро-протеиновое соотношение) имеет мультимодалное распределение с 3 горбами: наименьший горб (0.84 - 0.86), второй горб (0.88 - 0.9) и наибольший горб (0.92 - 0.96), остальные количественные параметры имеют нормальное распределение.
    - Больше всего коров старше 2 лет;
    - Вкусное молоко дает 58.7 % коров фермера.
4. Был проведен Корреляционный анализ, в ходе которого установлено:
    - Отсутствие ярких нелинейных связей, в связи с этим **добавление новых признаков - не требуется**. Но для признака `spr` наблюдается нелинейнейная связь;
    - `age` имеет очень высокую взаимосвязь с целевым признаком;
    - `dad_breed` имеет среднюю связь с целевым признаком;
    - `spr` сильно зависит от целевого признака - высокий коэффициент корреляции. В особенности видна резкая тенденция возвышения значений после. Связь похожа не нелинейную, но есть спорный момент с переходом в значении `spr = 0.91`;
    - Наблюдается отсутствие зависимости `yield` с `protein` — содержанием белков в молоке, вне зависимости от категориального признака;
    - Наблюдается слабая связь `yield` с категориальными признаками: содержанием сырого протеина в корме (`raw_protein`), породой (`breed`), типом пастбища (`type_pasture`), вкусом молока (`taste_milk`);
    - Мультиколлинеарность **отсутствует**: корреляционная матрица показала, что между некоторыми входными признаками есть умеренная корреляция, но нет явных признаков сильной мультиколлинеарности, с которой стоило бы справляться.
5. Была выполнена задача регрессии, в ходе которой:
    - Обучили 3 модели линейной регрессии из которой выбрали лучшую **показатели которой**:
      - `MAE` - 148.84 кг
      - `MSE` - 37066 $кг^2$
      - `RMSE` - 192.84 кг
      - `R2_score` - 0.8024   
    - Получили **95% доверительный интервал** лучшей модели = `(6096 - 6226)`   
    - Получили предсказания по всем коровам, рассматриваемые фермером к покупке, в результате получили, что все эти коровы удволетворяют условию удой не менее 6000 кг в год.
6. Была выполнена задача классификации:
    - В результате работы модели логистической регрессии, был предсказан вкус молока для коров, которых фермер хочет купить с учетом минимизации ошибок 1 - го рода с порогом классификации = 0.66.
    - Были посчитаны метрика качества данной модели:
        - `Accuracy` = 0.6226;
        - `Recall` = 0.0769;
        - `Precision` = 1.
7. Был проанализирован результат выполнения задач линейной и логистической регрессии, в ходе которого было предложено несколько вариантов действий:
    - Фермер не сможет купить не одну из рассматриваемых коров с отсутствующим риском.
  
## Пример работы

Получает датасет на вход:
![image](https://github.com/user-attachments/assets/db915f90-03fa-429e-995d-63d66b9b5ca4)

Результат - добавляет в датасет предсказания кол-ва удоя в кг и вкус молока:
![image](https://github.com/user-attachments/assets/ee668cab-7f63-4fea-bba8-637269307be7)
